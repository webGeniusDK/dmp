"undefined"!=typeof jQuery&&jQuery(function($){function WPBDP_ZIPDBImport_step(){inProgress?$.ajax({url:ajaxurl,data:{action:"wpbdp-zipcodesearch-import"},dataType:"json",success:function(res){var pcg=res.progress;$("td.progress .progress-bar .progress-bar-inner").attr("style","width: "+pcg+"%;"),$("td.progress .progress-text").text(pcg+"%"),$("td.progress .import-status-text").text(res.statusText),res.error?(inProgress=!1,alert(res.error)):(res.finished?(inProgress=!1,$(".import-step-2 tr.actions").fadeOut(),WPBDP_ZIPDBImportRebuildCache_step):WPBDP_ZIPDBImport_step)()}}):$(".import-status-text").removeClass("working")}function WPBDP_ZIPDBRebuildCache_step(url){var $status=$(".zipcodesearch-cache .status"),$progress=$(".progress",$status);$(".msg",$status).text("Working"),$progress.text([".","..","..."][$progress.text().length%3]),$.ajax({url:url,data:{},dataType:"json",success:function(res){res.done?(res.status?$(".msg",$status).text(res.statusText):($status.removeClass("notok").addClass("ok"),$(".msg",$status).text("OK")),$progress.text("")):WPBDP_ZIPDBRebuildCache_step(url)}})}var inProgress=!1,WPBDP_ZIPDBImportRebuildCache_step=($(".wpbdp-admin-page-zip-db-import a.resume-import").click(function(e){e.preventDefault(),inProgress?(inProgress=!1,$(this).text(wpbdpL10n.resume_import),$(this).addClass("button-primary"),$(".import-status-text").removeClass("working")):(inProgress=!0,(new Date).getTime(),$(this).text(wpbdpL10n.pause_import),$(this).removeClass("button-primary"),$(".import-status-text").addClass("working"),WPBDP_ZIPDBImport_step())}),function(){$.ajax({url:ajaxurl,data:{action:"wpbdp-zipcodesearch-rebuildcache"},dataType:"json",success:function(res){$(".import-status-text").text(res.statusText),res.done?$(".import-step-2").fadeOut(function(){$(".import-step-3").fadeIn(),$(this).remove()}):WPBDP_ZIPDBImportRebuildCache_step()}})});$(".wpbdp-admin-page-settings .zipcodesearch-cache a.rebuild-cache").click(function(e){e.preventDefault(),WPBDP_ZIPDBRebuildCache_step($(this).attr("href"))})});