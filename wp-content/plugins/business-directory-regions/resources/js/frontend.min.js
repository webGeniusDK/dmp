var WPBDP;void 0!==jQuery&&(WPBDP=jQuery.WPBDP=jQuery.extend({},jQuery.WPBDP,WPBDP),function($){$.WPBDP.Collapsible=function(element){this.element=$(element),this.handler=this.element.find(".js-handler").eq(0),this.subject=this.element.find("[data-collapsible]").eq(0),this.setup()},$.extend($.WPBDP.Collapsible.prototype,{setup:function(){var self=this;self.subject.hide(),self.toggleClass(),self.handler.click(function(event){self.toggle.apply(self,[event,this])}),"open"==self.subject.attr("data-collapsible-default-mode")&&self.handler.click()},toggleClass:function(){this.subject.is(":visible")?(this.handler.removeClass("bdopen").addClass("bdclose"),this.handler.find("span").removeClass("open").addClass("close")):(this.handler.removeClass("bdclose").addClass("bdopen"),this.handler.find("span").removeClass("close").addClass("open"))},toggle:function(event){event.preventDefault();var self=this;self.subject.slideToggle(function(){self.toggleClass()})}}),$.fn.collapsible=function(){return this.each(function(){var obj=new $.WPBDP.Collapsible(this);$.noop(obj)})}}(jQuery),function($){$.RegionField=function(container){this.container=container=$(container),this.select=container.find("select"),this.form=container.closest("form"),this.field=parseInt(this.select.attr("id").replace("wpbdp-field-",""),10),this.level=parseInt(container.attr("data-region-level"),10),this.display_context=this.container.attr("data-display-context"),this.select.change($.proxy(this,"change")),this.form.bind("wpbdp-region-selected",$.proxy(this,"update"));container="...";void 0!==$.RegionsFrontend&&void 0!==$.RegionsFrontend.UILoadingText&&(container=$.RegionsFrontend.UILoadingText),this.select.after($("<span>").addClass("spinner-text").css("display","none").text(container))},$.extend($.RegionField.prototype,{change:function(){var region=this.select.val();this.form.trigger("wpbdp-region-selected",[this.field,this.level,region])},update:function(event,field,level,region){var $spinner,self=this,hidden=self.container.is(":hidden");0===region||self.field===field||self.level<level||(levels=self.form.find(".wpbdp-region-field").map(function(){return parseInt($(this).attr("data-region-level"),10)}).get().sort(),updated_field_position=levels.indexOf(level),current_field_position=levels.indexOf(self.level),-1===updated_field_position)||-1===current_field_position||updated_field_position+1<current_field_position&&hidden||(($spinner=self.form.find("#wpbdp-field-"+field).siblings(".spinner-text")).fadeIn("fast"),$.getJSON("undefined"==typeof ajaxurl?$.RegionsFrontend.ajaxurl:ajaxurl,{action:"wpbdp-regions-get-regions",field:self.field,parent:region,level:self.level,display_context:self.display_context,category_id:self.form.find('input[name="category_id"]').val()},function(response){"ok"===response.status&&($spinner.fadeOut("fast"),response=$(response.html).find("option"),self.select.find("option").remove(),self.select.append(response).val(""),void 0!==self.select.data("selectpicker")&&self.select.selectpicker("refresh"),0===response.length||(response.length,0)?self.container.slideUp(function(){self.container.addClass("wpbdp-regions-hidden")}):hidden&&self.container.slideDown(function(){self.container.removeClass("wpbdp-regions-hidden")})),self.form.trigger("wpbdp-region-selected-after")}))}})}(jQuery),function($){function regions_init(){$(".wpbdp-region-field").each(function(){var field=new $.RegionField(this);$.noop(field)}),$(".wpbdp-region-selector").collapsible();var sidelist=$(".wpbdp-region-sidelist");sidelist.find(".js-handler").closest("li").collapsible(),sidelist.find("a[data-url]").each(function(){var element=$(this);element.attr("href",element.attr("data-url"))})}$(function(){regions_init()}),$(window).on("wpbdp_submit_refresh",function(event,submit,section_id){"listing_fields"==section_id&&regions_init()})}(jQuery),function($){$(document).ready(function(){$(".wpbdp-region-sidelist-wrapper .sidelist-menu-toggle").click(function(){$(".wpbdp-region-sidelist-wrapper").toggleClass("open")}),$(".wpbdp-regions-search-widget").each(function(i,v){var v=$(v),all_fields=v.find(".wpbdp-region-field");all_fields.not(".wpbdp-regions-hidden").toArray().sort(function(a,b){return parseInt($(a).attr("data-region-level"))-parseInt($(b).attr("data-region-level"))}),0!=all_fields.length&&(all_fields=all_fields.get(0),$(all_fields).removeClass("wpbdp-regions-hidden"),v.find(".wpbdp-region-field").not(all_fields).addClass("wpbdp-regions-hidden"))}),0<$(".wpbdp-region-field.wpbdp-search-filter").length&&($(".wpbdp-region-field.wpbdp-search-filter").parent().each(function(){$(this).find(".wpbdp-region-field.wpbdp-search-filter:first").removeClass("wpbdp-regions-hidden"),$(this).find(".wpbdp-region-field.wpbdp-search-filter").not(":first").addClass("wpbdp-regions-hidden")}),$(".wpbdp-region-field.wpbdp-search-filter").closest("form").bind("wpbdp-region-selected-after",function(){var all_fields=$(this).find(".wpbdp-region-field.wpbdp-search-filter"),level_with_region=0;all_fields.sort(function(a,b){return parseInt($(a).attr("data-region-level"))-parseInt($(b).attr("data-region-level"))}),all_fields.each(function(){!level_with_region&&$(this).find("select").val()&&(level_with_region=parseInt($(this).attr("data-region-level")))}),level_with_region||all_fields.not(":first").addClass("wpbdp-regions-hidden").hide()})),$(".wpbdp-region-selector").on("wpbdp-region-selected",function(event,field,level,region){var region_vals=[];$(this).find(".wpbdp-region-field select").each(function(){region_vals.push($(this).val())}),region_vals[0]?$(this).find('input[name="set-location"]').prop("disabled",!1).fadeIn("slow"):$(this).find('input[name="set-location"]').prop("disabled","disabled").fadeOut("fast")})})}(jQuery));