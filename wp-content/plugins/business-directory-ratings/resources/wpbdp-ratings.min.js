"undefined"==typeof WPBDP&&(WPBDP={}),"undefined"==typeof WPBDP_ratings?WPBDP.ratings={}:WPBDP.ratings=WPBDP_ratings,WPBDP.ratings.handleDelete=function(e){e.preventDefault();var $rating=jQuery(this).parents(".rating"),e=$rating.attr("data-id");jQuery.post(WPBDP.ratings._config.ajaxurl,{action:"wpbdp-ratings",a:"delete",id:e},function(res){res.success?(WPBDP.ratings.updateRating($rating.attr("data-listing-id")),$rating.fadeOut("fast",function(){$rating.remove()})):alert(res.msg)},"json")},WPBDP.ratings.handleEdit=function(e){e.preventDefault();var e=jQuery(this).parents(".rating"),$editform=jQuery(".rating-comment-edit",e),cancelLink=this.nextElementSibling;this.style.display="none",null!==cancelLink&&(this.nextElementSibling.style.display="inline"),jQuery(".rating-comment",e).toggle(),$editform.toggle()},WPBDP.ratings.cancelEdit=function(e){e.preventDefault();var e=jQuery(this).parents(".rating"),cancelLink=this.previousElementSibling;this.style.display="none",null!==cancelLink&&(this.previousElementSibling.style.display="inline"),jQuery(".rating-comment",e).show(),jQuery(".rating-comment-edit",e).hide()},WPBDP.ratings.saveEdit=function(e){e.preventDefault();var $rating=jQuery(this).parents(".rating"),e=jQuery(".rating-comment-edit textarea",$rating).val();jQuery.post(WPBDP.ratings._config.ajaxurl,{action:"wpbdp-ratings",a:"edit",id:$rating.attr("data-id"),comment:e},function(res){res.success?(jQuery(".rating-comment-edit textarea",$rating).val(res.comment),jQuery(".rating-comment",$rating).html(res.html).show(),jQuery(".rating-comment-edit, .cancel-button",$rating).hide(),jQuery(".edit",$rating).show()):alert(res.msg)},"json")},WPBDP.ratings.updateRating=function(post_id){jQuery.post(WPBDP.ratings._config.ajaxurl,{action:"wpbdp-ratings",a:"info",listing_id:post_id},function(res){res.success?(jQuery(".wpbdp-rating-info span.count .val").text(res.info.count),0==res.info.count&&jQuery(".wpbdp-ratings-reviews .no-reviews-message").show()):alert(res.msg)},"json")},WPBDP.ratings.init=function(){function updateStars(hovered){var starGroup=hovered.parentElement,stars=starGroup.children,current=parseInt(hovered.value),selectLabel=!1;starGroup.className+=" wpbdp-star-hovered";for(var i=0;i<stars.length;i++)void 0!==stars[i].className&&-1<stars[i].className.indexOf("bd-star-rating")?selectLabel?stars[i].className+=" bd-star-rating-hover":stars[i].classList.remove("bd-star-rating-hover","bd-star-rating-on"):selectLabel=parseInt(stars[i].value)<=current}jQuery(document).on("mouseenter click",".wpbdp-star-group input",function(){updateStars(this)}),jQuery(document).on("mouseenter",".wpbdp-star-group .bd-star-rating:not(.bd-star-rating-readonly)",function(){updateStars(this.previousElementSibling)}),jQuery(document).on("mouseleave",".wpbdp-star-group .bd-star-rating:not(.bd-star-rating-readonly)",function(){for(var starGroup=this.previousElementSibling.parentElement,stars=(starGroup.classList.remove("wpbdp-star-hovered"),starGroup.childNodes),selected=jQuery(starGroup).find("input:checked").attr("id"),isSelected="",i=stars.length-1;0<i;i--)void 0!==stars[i].className&&-1<stars[i].className.indexOf("bd-star-rating")&&(stars[i].classList.remove("bd-star-rating-hover"),""!==(isSelected=""===isSelected&&void 0!==selected&&stars[i].getAttribute("for")==selected?" bd-star-rating-on":isSelected))&&(stars[i].className+=isSelected)}),jQuery(document).on("click","#wpbdp-search-form .reset",function(){jQuery(".wpbdp-star-group .bd-star-rating").removeClass("bd-star-rating-on")}),jQuery(document).on("click","#wpbdp-ratings-admin-post-review .add-review-link",function(e){e.preventDefault(),jQuery(this).hide(),jQuery("#wpbdp-ratings-admin-post-review .form").fadeIn()}),jQuery(document).on("click","#wpbdp-ratings-admin-post-review .form a.wpbdp-ratings-add-btn",function(e){e.preventDefault(),e={action:"wpbdp-ratings-add","rating[listing_id]":jQuery('input[name="wpbdp_ratings_rating[listing_id]"]').val(),"rating[user_name]":jQuery('input[name="wpbdp_ratings_rating[user_name]"]').val(),"rating[rating]":jQuery('input[name="score"]:checked').val(),"rating[comment]":jQuery('textarea[name="wpbdp_ratings_rating[comment]"]').val()},jQuery.post(WPBDP.ratings._config.ajaxurl,e,function(response){var $new;response.ok?($new=jQuery(response.html),jQuery("#wpbdp-ratings tr.no-items").hide(),jQuery("#wpbdp-ratings table").prepend($new),jQuery("#wpbdp-ratings-admin-post-review .form").hide(),jQuery("#wpbdp-ratings-admin-post-review input[type=text], #wpbdp-ratings-admin-post-review textarea").val(""),jQuery("#wpbdp-ratings-admin-post-review input[type=radio]").prop("checked",!1),jQuery("#wpbdp-ratings-admin-post-review .bd-star-rating-on").removeClass("bd-star-rating-on"),jQuery("#wpbdp-ratings-admin-post-review .form a.button-secondary").click()):alert(response.errormsg||"Unknown Error")},"json"),jQuery("#wpbdp-ratings-admin-post-review .add-review-link").show()}),jQuery(document).on("click",".listing-ratings .edit-actions .edit",WPBDP.ratings.handleEdit),jQuery(document).on("click",".listing-ratings .edit-actions .delete",WPBDP.ratings.handleDelete),jQuery(document).on("click",".listing-ratings .cancel-button",WPBDP.ratings.cancelEdit),jQuery(document).on("click",".listing-ratings .rating-comment-edit input.save-button",WPBDP.ratings.saveEdit),jQuery(document).on("click",".show-review-form-button",function(){jQuery(".review-form").toggleClass("wpbdp-hide-on-mobile")}),jQuery("a.rate-listing-link").on("click",function(e){var tabId,$reviewForm=jQuery(".review-form");$reviewForm.is(":visible")||0<($reviewForm=$reviewForm.closest(".ui-tabs-panel")).length&&void 0!==(tabId=$reviewForm.attr("aria-labelledby"))&&0<($reviewForm=jQuery("#"+tabId)).length&&$reviewForm.trigger("click")})},jQuery(function($){WPBDP.ratings.init()});